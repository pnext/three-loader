!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define("potree",["three"],e):"object"==typeof exports?exports.potree=e(require("three")):t.potree=e(t.three)}(self,(function(t){return(()=>{var e={689:(t,e)=>{"use strict";function n(t){this.content=[],this.scoreFunction=t}e.L=n,n.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},remove:function(t){for(var e=this.content.length,n=0;n<e;n++)if(this.content[n]==t){var i=this.content.pop();if(n==e-1)break;this.content[n]=i,this.bubbleUp(n),this.sinkDown(n);break}},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t],n=this.scoreFunction(e);t>0;){var i=Math.floor((t+1)/2)-1,u=this.content[i];if(n>=this.scoreFunction(u))break;this.content[i]=e,this.content[t]=u,t=i}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var u=2*(t+1),o=u-1,r=null;if(o<e){var s=this.content[o],a=this.scoreFunction(s);a<i&&(r=o)}if(u<e){var l=this.content[u];this.scoreFunction(l)<(null==r?i:a)&&(r=u)}if(null==r)break;this.content[t]=this.content[r],this.content[r]=n,t=r}}}},142:function(t){t.exports=function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t((function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),n=t((function(t){var e=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)})),i=(n.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),u=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t},o=function(t){try{return!!t()}catch(t){return!0}},r=!o((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),s=e.document,a=i(s)&&i(s.createElement),l=!r&&!o((function(){return 7!=Object.defineProperty((t="div",a?s.createElement(t):{}),"a",{get:function(){return 7}}).a;var t})),c=Object.defineProperty,D={f:r?Object.defineProperty:function(t,e,n){if(u(t),e=function(t,e){if(!i(t))return t;var n,u;if(e&&"function"==typeof(n=t.toString)&&!i(u=n.call(t)))return u;if("function"==typeof(n=t.valueOf)&&!i(u=n.call(t)))return u;if(!e&&"function"==typeof(n=t.toString)&&!i(u=n.call(t)))return u;throw TypeError("Can't convert object to primitive value")}(e,!0),u(n),l)try{return c(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},d=r?function(t,e,n){return D.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},f={}.hasOwnProperty,p=function(t,e){return f.call(t,e)},h=0,C=Math.random(),A=t((function(t){var i="__core-js_shared__",u=e[i]||(e[i]={});(t.exports=function(t,e){return u[t]||(u[t]=void 0!==e?e:{})})("versions",[]).push({version:n.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),g=A("native-function-to-string",Function.toString),F=t((function(t){var i=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++h+C).toString(36))}("src"),u="toString",o=(""+g).split(u);n.inspectSource=function(t){return g.call(t)},(t.exports=function(t,n,u,r){var s="function"==typeof u;s&&(p(u,"name")||d(u,"name",n)),t[n]!==u&&(s&&(p(u,i)||d(u,i,t[n]?""+t[n]:o.join(String(n)))),t===e?t[n]=u:r?t[n]?t[n]=u:d(t,n,u):(delete t[n],d(t,n,u)))})(Function.prototype,u,(function(){return"function"==typeof this&&this[i]||g.call(this)}))})),m=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,u){return t.call(e,n,i,u)}}return function(){return t.apply(e,arguments)}},E=function(t,i,u){var o,r,s,a,l=t&E.F,c=t&E.G,D=t&E.S,f=t&E.P,p=t&E.B,h=c?e:D?e[i]||(e[i]={}):(e[i]||{}).prototype,C=c?n:n[i]||(n[i]={}),A=C.prototype||(C.prototype={});for(o in c&&(u=i),u)s=((r=!l&&h&&void 0!==h[o])?h:u)[o],a=p&&r?m(s,e):f&&"function"==typeof s?m(Function.call,s):s,h&&F(h,o,s,t&E.U),C[o]!=s&&d(C,o,a),f&&A[o]!=s&&(A[o]=s)};e.core=n,E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128;var v,B=E,y=Math.ceil,x=Math.floor,_=function(t){return isNaN(t=+t)?0:(t>0?x:y)(t)},b=(v=!1,function(t,e){var n,i,u=String(function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}(t)),o=_(e),r=u.length;return o<0||o>=r?v?"":void 0:(n=u.charCodeAt(o))<55296||n>56319||o+1===r||(i=u.charCodeAt(o+1))<56320||i>57343?v?u.charAt(o):n:v?u.slice(o,o+2):i-56320+(n-55296<<10)+65536});B(B.P,"String",{codePointAt:function(t){return b(this,t)}}),n.String.codePointAt;var w=Math.max,T=Math.min,S=function(t,e){return(t=_(t))<0?w(t+e,0):T(t,e)},P=String.fromCharCode,N=String.fromCodePoint;B(B.S+B.F*(!!N&&1!=N.length),"String",{fromCodePoint:function(t){for(var e,n=arguments,i=[],u=arguments.length,o=0;u>o;){if(e=+n[o++],S(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?P(e):P(55296+((e-=65536)>>10),e%1024+56320))}return i.join("")}}),n.String.fromCodePoint;var I,O,L,M,R,z,G,U,V,H,k,W,j,X,Y={Space_Separator:/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ID_Start:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,ID_Continue:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},K=function(t){return"string"==typeof t&&Y.Space_Separator.test(t)},J=function(t){return"string"==typeof t&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||"$"===t||"_"===t||Y.ID_Start.test(t))},q=function(t){return"string"==typeof t&&(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||"$"===t||"_"===t||"‌"===t||"‍"===t||Y.ID_Continue.test(t))},$=function(t){return"string"==typeof t&&/[0-9]/.test(t)},Q=function(t){return"string"==typeof t&&/[0-9A-Fa-f]/.test(t)};function Z(t,e,n){var i=t[e];if(null!=i&&"object"==typeof i)for(var u in i){var o=Z(i,u,n);void 0===o?delete i[u]:i[u]=o}return n.call(t,e,i)}function tt(){for(H="default",k="",W=!1,j=1;;){X=et();var t=it[H]();if(t)return t}}function et(){if(I[M])return String.fromCodePoint(I.codePointAt(M))}function nt(){var t=et();return"\n"===t?(R++,z=0):t?z+=t.length:z++,t&&(M+=t.length),t}var it={default:function(){switch(X){case"\t":case"\v":case"\f":case" ":case" ":case"\ufeff":case"\n":case"\r":case"\u2028":case"\u2029":return void nt();case"/":return nt(),void(H="comment");case void 0:return nt(),ut("eof")}if(!K(X))return it[O]();nt()},comment:function(){switch(X){case"*":return nt(),void(H="multiLineComment");case"/":return nt(),void(H="singleLineComment")}throw ct(nt())},multiLineComment:function(){switch(X){case"*":return nt(),void(H="multiLineCommentAsterisk");case void 0:throw ct(nt())}nt()},multiLineCommentAsterisk:function(){switch(X){case"*":return void nt();case"/":return nt(),void(H="default");case void 0:throw ct(nt())}nt(),H="multiLineComment"},singleLineComment:function(){switch(X){case"\n":case"\r":case"\u2028":case"\u2029":return nt(),void(H="default");case void 0:return nt(),ut("eof")}nt()},value:function(){switch(X){case"{":case"[":return ut("punctuator",nt());case"n":return nt(),ot("ull"),ut("null",null);case"t":return nt(),ot("rue"),ut("boolean",!0);case"f":return nt(),ot("alse"),ut("boolean",!1);case"-":case"+":return"-"===nt()&&(j=-1),void(H="sign");case".":return k=nt(),void(H="decimalPointLeading");case"0":return k=nt(),void(H="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return k=nt(),void(H="decimalInteger");case"I":return nt(),ot("nfinity"),ut("numeric",1/0);case"N":return nt(),ot("aN"),ut("numeric",NaN);case'"':case"'":return W='"'===nt(),k="",void(H="string")}throw ct(nt())},identifierNameStartEscape:function(){if("u"!==X)throw ct(nt());nt();var t=rt();switch(t){case"$":case"_":break;default:if(!J(t))throw dt()}k+=t,H="identifierName"},identifierName:function(){switch(X){case"$":case"_":case"‌":case"‍":return void(k+=nt());case"\\":return nt(),void(H="identifierNameEscape")}if(!q(X))return ut("identifier",k);k+=nt()},identifierNameEscape:function(){if("u"!==X)throw ct(nt());nt();var t=rt();switch(t){case"$":case"_":case"‌":case"‍":break;default:if(!q(t))throw dt()}k+=t,H="identifierName"},sign:function(){switch(X){case".":return k=nt(),void(H="decimalPointLeading");case"0":return k=nt(),void(H="zero");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return k=nt(),void(H="decimalInteger");case"I":return nt(),ot("nfinity"),ut("numeric",j*(1/0));case"N":return nt(),ot("aN"),ut("numeric",NaN)}throw ct(nt())},zero:function(){switch(X){case".":return k+=nt(),void(H="decimalPoint");case"e":case"E":return k+=nt(),void(H="decimalExponent");case"x":case"X":return k+=nt(),void(H="hexadecimal")}return ut("numeric",0*j)},decimalInteger:function(){switch(X){case".":return k+=nt(),void(H="decimalPoint");case"e":case"E":return k+=nt(),void(H="decimalExponent")}if(!$(X))return ut("numeric",j*Number(k));k+=nt()},decimalPointLeading:function(){if($(X))return k+=nt(),void(H="decimalFraction");throw ct(nt())},decimalPoint:function(){switch(X){case"e":case"E":return k+=nt(),void(H="decimalExponent")}return $(X)?(k+=nt(),void(H="decimalFraction")):ut("numeric",j*Number(k))},decimalFraction:function(){switch(X){case"e":case"E":return k+=nt(),void(H="decimalExponent")}if(!$(X))return ut("numeric",j*Number(k));k+=nt()},decimalExponent:function(){switch(X){case"+":case"-":return k+=nt(),void(H="decimalExponentSign")}if($(X))return k+=nt(),void(H="decimalExponentInteger");throw ct(nt())},decimalExponentSign:function(){if($(X))return k+=nt(),void(H="decimalExponentInteger");throw ct(nt())},decimalExponentInteger:function(){if(!$(X))return ut("numeric",j*Number(k));k+=nt()},hexadecimal:function(){if(Q(X))return k+=nt(),void(H="hexadecimalInteger");throw ct(nt())},hexadecimalInteger:function(){if(!Q(X))return ut("numeric",j*Number(k));k+=nt()},string:function(){switch(X){case"\\":return nt(),void(k+=function(){switch(et()){case"b":return nt(),"\b";case"f":return nt(),"\f";case"n":return nt(),"\n";case"r":return nt(),"\r";case"t":return nt(),"\t";case"v":return nt(),"\v";case"0":if(nt(),$(et()))throw ct(nt());return"\0";case"x":return nt(),function(){var t="",e=et();if(!Q(e))throw ct(nt());if(t+=nt(),e=et(),!Q(e))throw ct(nt());return t+=nt(),String.fromCodePoint(parseInt(t,16))}();case"u":return nt(),rt();case"\n":case"\u2028":case"\u2029":return nt(),"";case"\r":return nt(),"\n"===et()&&nt(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case void 0:throw ct(nt())}return nt()}());case'"':return W?(nt(),ut("string",k)):void(k+=nt());case"'":return W?void(k+=nt()):(nt(),ut("string",k));case"\n":case"\r":case void 0:throw ct(nt());case"\u2028":case"\u2029":!function(t){console.warn("JSON5: '"+ft(t)+"' in strings is not valid ECMAScript; consider escaping")}(X)}k+=nt()},start:function(){switch(X){case"{":case"[":return ut("punctuator",nt())}H="value"},beforePropertyName:function(){switch(X){case"$":case"_":return k=nt(),void(H="identifierName");case"\\":return nt(),void(H="identifierNameStartEscape");case"}":return ut("punctuator",nt());case'"':case"'":return W='"'===nt(),void(H="string")}if(J(X))return k+=nt(),void(H="identifierName");throw ct(nt())},afterPropertyName:function(){if(":"===X)return ut("punctuator",nt());throw ct(nt())},beforePropertyValue:function(){H="value"},afterPropertyValue:function(){switch(X){case",":case"}":return ut("punctuator",nt())}throw ct(nt())},beforeArrayValue:function(){if("]"===X)return ut("punctuator",nt());H="value"},afterArrayValue:function(){switch(X){case",":case"]":return ut("punctuator",nt())}throw ct(nt())},end:function(){throw ct(nt())}};function ut(t,e){return{type:t,value:e,line:R,column:z}}function ot(t){for(var e=0,n=t;e<n.length;e+=1){var i=n[e];if(et()!==i)throw ct(nt());nt()}}function rt(){for(var t="",e=4;e-- >0;){var n=et();if(!Q(n))throw ct(nt());t+=nt()}return String.fromCodePoint(parseInt(t,16))}var st={start:function(){if("eof"===G.type)throw Dt();at()},beforePropertyName:function(){switch(G.type){case"identifier":case"string":return U=G.value,void(O="afterPropertyName");case"punctuator":return void lt();case"eof":throw Dt()}},afterPropertyName:function(){if("eof"===G.type)throw Dt();O="beforePropertyValue"},beforePropertyValue:function(){if("eof"===G.type)throw Dt();at()},beforeArrayValue:function(){if("eof"===G.type)throw Dt();"punctuator"!==G.type||"]"!==G.value?at():lt()},afterPropertyValue:function(){if("eof"===G.type)throw Dt();switch(G.value){case",":return void(O="beforePropertyName");case"}":lt()}},afterArrayValue:function(){if("eof"===G.type)throw Dt();switch(G.value){case",":return void(O="beforeArrayValue");case"]":lt()}},end:function(){}};function at(){var t;switch(G.type){case"punctuator":switch(G.value){case"{":t={};break;case"[":t=[]}break;case"null":case"boolean":case"numeric":case"string":t=G.value}if(void 0===V)V=t;else{var e=L[L.length-1];Array.isArray(e)?e.push(t):e[U]=t}if(null!==t&&"object"==typeof t)L.push(t),O=Array.isArray(t)?"beforeArrayValue":"beforePropertyName";else{var n=L[L.length-1];O=null==n?"end":Array.isArray(n)?"afterArrayValue":"afterPropertyValue"}}function lt(){L.pop();var t=L[L.length-1];O=null==t?"end":Array.isArray(t)?"afterArrayValue":"afterPropertyValue"}function ct(t){return pt(void 0===t?"JSON5: invalid end of input at "+R+":"+z:"JSON5: invalid character '"+ft(t)+"' at "+R+":"+z)}function Dt(){return pt("JSON5: invalid end of input at "+R+":"+z)}function dt(){return pt("JSON5: invalid identifier character at "+R+":"+(z-=5))}function ft(t){var e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[t])return e[t];if(t<" "){var n=t.charCodeAt(0).toString(16);return"\\x"+("00"+n).substring(n.length)}return t}function pt(t){var e=new SyntaxError(t);return e.lineNumber=R,e.columnNumber=z,e}return{parse:function(t,e){I=String(t),O="start",L=[],M=0,R=1,z=0,G=void 0,U=void 0,V=void 0;do{G=tt(),st[O]()}while("eof"!==G.type);return"function"==typeof e?Z({"":V},"",e):V},stringify:function(t,e,n){var i,u,o,r=[],s="",a="";if(null==e||"object"!=typeof e||Array.isArray(e)||(n=e.space,o=e.quote,e=e.replacer),"function"==typeof e)u=e;else if(Array.isArray(e)){i=[];for(var l=0,c=e;l<c.length;l+=1){var D=c[l],d=void 0;"string"==typeof D?d=D:("number"==typeof D||D instanceof String||D instanceof Number)&&(d=String(D)),void 0!==d&&i.indexOf(d)<0&&i.push(d)}}return n instanceof Number?n=Number(n):n instanceof String&&(n=String(n)),"number"==typeof n?n>0&&(n=Math.min(10,Math.floor(n)),a="          ".substr(0,n)):"string"==typeof n&&(a=n.substr(0,10)),f("",{"":t});function f(t,e){var n=e[t];switch(null!=n&&("function"==typeof n.toJSON5?n=n.toJSON5(t):"function"==typeof n.toJSON&&(n=n.toJSON(t))),u&&(n=u.call(e,t,n)),n instanceof Number?n=Number(n):n instanceof String?n=String(n):n instanceof Boolean&&(n=n.valueOf()),n){case null:return"null";case!0:return"true";case!1:return"false"}return"string"==typeof n?p(n):"number"==typeof n?String(n):"object"==typeof n?Array.isArray(n)?function(t){if(r.indexOf(t)>=0)throw TypeError("Converting circular structure to JSON5");r.push(t);var e=s;s+=a;for(var n,i=[],u=0;u<t.length;u++){var o=f(String(u),t);i.push(void 0!==o?o:"null")}if(0===i.length)n="[]";else if(""===a)n="["+i.join(",")+"]";else{var l=",\n"+s,c=i.join(l);n="[\n"+s+c+",\n"+e+"]"}return r.pop(),s=e,n}(n):function(t){if(r.indexOf(t)>=0)throw TypeError("Converting circular structure to JSON5");r.push(t);var e=s;s+=a;for(var n,u,o=[],l=0,c=i||Object.keys(t);l<c.length;l+=1){var D=c[l],d=f(D,t);if(void 0!==d){var p=h(D)+":";""!==a&&(p+=" "),p+=d,o.push(p)}}if(0===o.length)n="{}";else if(""===a)n="{"+(u=o.join(","))+"}";else{var C=",\n"+s;u=o.join(C),n="{\n"+s+u+",\n"+e+"}"}return r.pop(),s=e,n}(n):void 0}function p(t){for(var e={"'":.1,'"':.2},n={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},i="",u=0;u<t.length;u++){var r=t[u];switch(r){case"'":case'"':e[r]++,i+=r;continue;case"\0":if($(t[u+1])){i+="\\x00";continue}}if(n[r])i+=n[r];else if(r<" "){var s=r.charCodeAt(0).toString(16);i+="\\x"+("00"+s).substring(s.length)}else i+=r}var a=o||Object.keys(e).reduce((function(t,n){return e[t]<e[n]?t:n}));return a+(i=i.replace(new RegExp(a,"g"),n[a]))+a}function h(t){if(0===t.length)return p(t);var e=String.fromCodePoint(t.codePointAt(0));if(!J(e))return p(t);for(var n=e.length;n<t.length;n++)if(!q(String.fromCodePoint(t.codePointAt(n))))return p(t);return t}}}}()},913:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i="precision highp float;\nprecision highp int;\n\nuniform mat4 projectionMatrix;\n\nuniform float screenWidth;\nuniform float screenHeight;\n\nuniform sampler2D map;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tfloat dx = 1.0 / screenWidth;\n\tfloat dy = 1.0 / screenHeight;\n\n\tvec3 color = vec3(0.0, 0.0, 0.0);\n\tcolor += texture2D(map, vUv + vec2(-dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx, -dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,   0)).rgb;\n\tcolor += texture2D(map, vUv + vec2(-dx,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(  0,  dy)).rgb;\n\tcolor += texture2D(map, vUv + vec2(+dx,  dy)).rgb;\n    \n\tcolor = color / 9.0;\n\t\n\tgl_FragColor = vec4(color, 1.0);\n\t\n\t\n}"},412:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});const i="precision highp float;\nprecision highp int;\n\nattribute vec3 position;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n\n    gl_Position =   projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},53:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i="// #if defined paraboloid_point_shape\n// \t#extension GL_EXT_frag_depth : enable\n// #endif\n\nprecision highp float;\nprecision highp int;\n\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\nuniform mat4 projectionMatrix;\nuniform float opacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float spacing;\nuniform float pcIndex;\nuniform float screenWidth;\nuniform float screenHeight;\n\nuniform sampler2D depthMap;\n\n#ifdef highlight_point\n\tuniform vec4 highlightedPointColor;\n#endif\n\nin vec3 vColor;\n\n#if !defined(color_type_point_index)\n\tin float vOpacity;\n#endif\n\n#if defined(weighted_splats)\n\tin float vLinearDepth;\n#endif\n\n#if !defined(paraboloid_point_shape) && defined(use_edl)\n\tin float vLogDepth;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\tin vec3 vViewPosition;\n#endif\n\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\tin float vRadius;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\tin vec3 vNormal;\n#endif\n\n#ifdef highlight_point\n\tin float vHighlight;\n#endif\n\nlayout(location=0) out vec4 out_FragColor;\n\n\nfloat specularStrength = 1.0;\n\nvoid main() {\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined(circle_point_shape) || defined(paraboloid_point_shape) || defined (weighted_splats)\n\t\tfloat u = 2.0 * gl_PointCoord.x - 1.0;\n\t\tfloat v = 2.0 * gl_PointCoord.y - 1.0;\n\t#endif\n\n\t#if defined(circle_point_shape) || defined (weighted_splats)\n\t\tfloat cc = u*u + v*v;\n\t\tif(cc > 1.0){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\n\t#if defined weighted_splats\n\t\tvec2 uv = gl_FragCoord.xy / vec2(screenWidth, screenHeight);\n\t\tfloat sDepth = texture(depthMap, uv).r;\n\t\tif(vLinearDepth > sDepth + vRadius + blendDepthSupplement){\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\n\t#if defined color_type_point_index\n\t\tout_FragColor = vec4(color, pcIndex / 255.0);\n\t#else\n\t\tout_FragColor = vec4(color, vOpacity);\n\t#endif\n\n\t#if defined(color_type_phong)\n\t\t#if MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0\n\t\t\tvec3 normal = normalize( vNormal );\n\t\t\tnormal.z = abs(normal.z);\n\n\t\t\tvec3 viewPosition = normalize( vViewPosition );\n\t\t#endif\n\n\t\t// code taken from three.js phong light fragment shader\n\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\tvec3 pointDiffuse = vec3( 0.0 );\n\t\t\tvec3 pointSpecular = vec3( 0.0 );\n\n\t\t\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\t\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\t\t\tfloat lDistance = 1.0;\n\t\t\t\tif ( pointLightDistance[ i ] > 0.0 )\n\t\t\t\t\tlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n\t\t\t\tlVector = normalize( lVector );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tpointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n\t\t\t\t// specular\n\n\t\t\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\t\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\t\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tpointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\t\t\t\tpointSpecular = vec3(0.0, 0.0, 0.0);\n\t\t\t}\n\n\t\t#endif\n\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\tvec3 dirDiffuse = vec3( 0.0 );\n\t\t\tvec3 dirSpecular = vec3( 0.0 );\n\n\t\t\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\t\t\tvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n\t\t\t\tvec3 dirVector = normalize( lDirection.xyz );\n\n\t\t\t\t\t\t// diffuse\n\n\t\t\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t\t#else\n\n\t\t\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t\t#endif\n\n\t\t\t\tdirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t\t\t// specular\n\n\t\t\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\t\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\t\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\t\t\tdirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\t\t\t}\n\n\t\t#endif\n\n\t\tvec3 totalDiffuse = vec3( 0.0 );\n\t\tvec3 totalSpecular = vec3( 0.0 );\n\n\t\t#if MAX_POINT_LIGHTS > 0\n\n\t\t\ttotalDiffuse += pointDiffuse;\n\t\t\ttotalSpecular += pointSpecular;\n\n\t\t#endif\n\n\t\t#if MAX_DIR_LIGHTS > 0\n\n\t\t\ttotalDiffuse += dirDiffuse;\n\t\t\ttotalSpecular += dirSpecular;\n\n\t\t#endif\n\n\t\tout_FragColor.xyz = out_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n\t#endif\n\n\t#if defined weighted_splats\n\t    //float w = pow(1.0 - (u*u + v*v), blendHardness);\n\n\t\tfloat wx = 2.0 * length(2.0 * gl_PointCoord - 1.0);\n\t\tfloat w = exp(-wx * wx * 0.5);\n\n\t\t//float distance = length(2.0 * gl_PointCoord - 1.0);\n\t\t//float w = exp( -(distance * distance) / blendHardness);\n\n\t\tout_FragColor.rgb = out_FragColor.rgb * w;\n\t\tout_FragColor.a = w;\n\t#endif\n\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = 0.0 - ( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\t\tgl_FragDepth = depth;\n\n\t\t#if defined(color_type_depth)\n\t\t\tout_FragColor.r = linearDepth;\n\t\t\tout_FragColor.g = expDepth;\n\t\t#endif\n\n\t\t#if defined(use_edl)\n\t\t\tout_FragColor.a = log2(linearDepth);\n\t\t#endif\n\n\t#else\n\t\t#if defined(use_edl)\n\t\t\tout_FragColor.a = vLogDepth;\n\t\t#endif\n\t#endif\n\n\t#ifdef highlight_point\n\t\tif (vHighlight > 0.0) {\n\t\t\tout_FragColor = highlightedPointColor;\n\t\t}\n\t#endif\n}\n"},59:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});const i="precision highp float;\nprecision highp int;\n\n#define max_clip_boxes 30\n\nin vec3 position;\nin vec3 color;\nin vec3 normal;\nin float intensity;\nin float classification;\nin float returnNumber;\nin float numberOfReturns;\nin float pointSourceID;\nin vec4 indices;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\n\nuniform float pcIndex;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float fov;\nuniform float spacing;\n\n#if defined use_clip_box\n\tuniform mat4 clipBoxes[max_clip_boxes];\n#endif\n\n#if NUM_CLIP_PLANES > 0\n\tuniform vec4 clippingPlanes[NUM_CLIP_PLANES];\n#endif\n\nuniform float heightMin;\nuniform float heightMax;\nuniform float size; // pixel size factor\nuniform float minSize; // minimum pixel size\nuniform float maxSize; // maximum pixel size\nuniform float octreeSize;\nuniform vec3 bbSize;\nuniform vec3 uColor;\nuniform float opacity;\nuniform float clipBoxCount;\nuniform float level;\nuniform float vnStart;\nuniform bool isLeafNode;\n\nuniform float filterByNormalThreshold;\nuniform vec2 intensityRange;\nuniform float opacityAttenuation;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float transition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\nuniform sampler2D depthMap;\n\n#ifdef highlight_point\n\tuniform vec3 highlightedPointCoordinate;\n\tuniform bool enablePointHighlighting;\n\tuniform float highlightedPointScale;\n#endif\n\nout vec3 vColor;\n\n#if !defined(color_type_point_index)\n\tout float vOpacity;\n#endif\n\n#if defined(weighted_splats)\n\tout float vLinearDepth;\n#endif\n\n#if !defined(paraboloid_point_shape) && defined(use_edl)\n\tout float vLogDepth;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\tout vec3 vViewPosition;\n#endif\n\n#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\tout float vRadius;\n#endif\n\n#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\tout vec3 vNormal;\n#endif\n\n#ifdef highlight_point\n\tout float vHighlight;\n#endif\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_octree)\n\n/**\n * Rounds the specified number to the closest integer.\n */\nfloat round(float number){\n\treturn floor(number + 0.5);\n}\n\n/**\n * Gets the number of 1-bits up to inclusive index position.\n *\n * number is treated as if it were an integer in the range 0-255\n */\nint numberOfOnes(int number, int index) {\n\tint numOnes = 0;\n\tint tmp = 128;\n\tfor (int i = 7; i >= 0; i--) {\n\n\t\tif (number >= tmp) {\n\t\t\tnumber = number - tmp;\n\n\t\t\tif (i <= index) {\n\t\t\t\tnumOnes++;\n\t\t\t}\n\t\t}\n\n\t\ttmp = tmp / 2;\n\t}\n\n\treturn numOnes;\n}\n\n/**\n * Checks whether the bit at index is 1.0\n *\n * number is treated as if it were an integer in the range 0-255\n */\nbool isBitSet(int number, int index){\n\n\t// weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\n\tint powi = 1;\n\tif (index == 0) {\n\t\tpowi = 1;\n\t} else if (index == 1) {\n\t\tpowi = 2;\n\t} else if (index == 2) {\n\t\tpowi = 4;\n\t} else if (index == 3) {\n\t\tpowi = 8;\n\t} else if (index == 4) {\n\t\tpowi = 16;\n\t} else if (index == 5) {\n\t\tpowi = 32;\n\t} else if (index == 6) {\n\t\tpowi = 64;\n\t} else if (index == 7) {\n\t\tpowi = 128;\n\t}\n\n\tint ndp = number / powi;\n\n\treturn mod(float(ndp), 2.0) != 0.0;\n}\n\n/**\n * Gets the the LOD at the point position.\n */\nfloat getLOD() {\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tint iOffset = int(vnStart);\n\tfloat depth = level;\n\n\tfor (float i = 0.0; i <= 30.0; i++) {\n\t\tfloat nodeSizeAtLevel = octreeSize  / pow(2.0, i + level + 0.0);\n\n\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\tindex3d = floor(index3d + 0.5);\n\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\n\t\tvec4 value = texture(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\tint mask = int(round(value.r * 255.0));\n\n\t\tif (isBitSet(mask, index)) {\n\t\t\t// there are more visible child nodes at this position\n\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\tiOffset = iOffset + advance;\n\n\t\t\tdepth++;\n\t\t} else {\n\t\t\treturn value.a * 255.0; // no more visible child nodes at this position\n\t\t}\n\n\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t}\n\n\treturn depth;\n}\n\nfloat getPointSizeAttenuation() {\n\treturn 0.5 * pow(2.0, getLOD());\n}\n\n#endif\n\n// ---------------------\n// KD-TREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod)) && defined(tree_type_kdtree)\n\nfloat getLOD() {\n\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\tfloat intOffset = 0.0;\n\tfloat depth = 0.0;\n\n\tvec3 size = bbSize;\n\tvec3 pos = position;\n\n\tfor (float i = 0.0; i <= 1000.0; i++) {\n\n\t\tvec4 value = texture(visibleNodes, vec2(intOffset / 2048.0, 0.0));\n\n\t\tint children = int(value.r * 255.0);\n\t\tfloat next = value.g * 255.0;\n\t\tint split = int(value.b * 255.0);\n\n\t\tif (next == 0.0) {\n\t\t \treturn depth;\n\t\t}\n\n\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\tif (split == 1) {\n\t\t\tsplitv.x = 1.0;\n\t\t} else if (split == 2) {\n\t\t \tsplitv.y = 1.0;\n\t\t} else if (split == 4) {\n\t\t \tsplitv.z = 1.0;\n\t\t}\n\n\t\tintOffset = intOffset + next;\n\n\t\tfloat factor = length(pos * splitv / size);\n\t\tif (factor < 0.5) {\n\t\t \t// left\n\t\t\tif (children == 0 || children == 2) {\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t} else {\n\t\t\t// right\n\t\t\tpos = pos - size * splitv * 0.5;\n\t\t\tif (children == 0 || children == 1) {\n\t\t\t\treturn depth;\n\t\t\t}\n\t\t\tif (children == 3) {\n\t\t\t\tintOffset = intOffset + 1.0;\n\t\t\t}\n\t\t}\n\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\n\t\tdepth++;\n\t}\n\n\n\treturn depth;\n}\n\nfloat getPointSizeAttenuation() {\n\treturn 0.5 * pow(1.3, getLOD());\n}\n\n#endif\n\n// formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast) {\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB() {\n\t#if defined(use_rgb_gamma_contrast_brightness)\n\t  vec3 rgb = color;\n\t\trgb = pow(rgb, vec3(rgbGamma));\n\t\trgb = rgb + rgbBrightness;\n\t\trgb = (rgb - 0.5) * getContrastFactor(rgbContrast) + 0.5;\n\t\trgb = clamp(rgb, 0.0, 1.0);\n\t\treturn rgb;\n\t#else\n\t\treturn color;\n\t#endif\n}\n\nfloat getIntensity() {\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\n\treturn w;\n}\n\nvec3 getElevation() {\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - heightMin) / (heightMax-heightMin);\n\tvec3 cElevation = texture(gradient, vec2(w,1.0-w)).rgb;\n\n\treturn cElevation;\n}\n\nvec4 getClassification() {\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\tvec4 classColor = texture(classificationLUT, uv);\n\n\treturn classColor;\n}\n\nvec3 getReturnNumber() {\n\tif (numberOfReturns == 1.0) {\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t} else {\n\t\tif (returnNumber == 1.0) {\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t} else if (returnNumber == numberOfReturns) {\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t} else {\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID() {\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture(gradient, vec2(w, 1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor() {\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\n\tvec4 cl = wClassification * getClassification();\n\tc += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\n\t// if (w == 0.0) {\n\t// \tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t// }\n\n\treturn c;\n}\n\nvoid main() {\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\tvec4 mPosition = modelMatrix * vec4(position, 1.0);\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0) || defined(paraboloid_point_shape)\n\t\tvViewPosition = mvPosition.xyz;\n\t#endif\n\n\t#if defined weighted_splats\n\t\tvLinearDepth = gl_Position.w;\n\t#endif\n\n\t#if defined(color_type_phong) && (MAX_POINT_LIGHTS > 0 || MAX_DIR_LIGHTS > 0)\n\t\tvNormal = normalize(normalMatrix * normal);\n\t#endif\n\n\t#if !defined(paraboloid_point_shape) && defined(use_edl)\n\t\tvLogDepth = log2(-mvPosition.z);\n\t#endif\n\n\t// ---------------------\n\t// POINT SIZE\n\t// ---------------------\n\n\tfloat pointSize = 1.0;\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor =  -0.5 * screenHeight / (slope * mvPosition.z);\n\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tpointSize = size * spacing * projFactor;\n\t#elif defined adaptive_point_size\n\t\tfloat worldSpaceSize = 2.0 * size * spacing / getPointSizeAttenuation();\n\t\tpointSize = worldSpaceSize * projFactor;\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\n\t#if defined(weighted_splats) || defined(paraboloid_point_shape)\n\t\tvRadius = pointSize / projFactor;\n\t#endif\n\n\tgl_PointSize = pointSize;\n\n\t// ---------------------\n\t// HIGHLIGHTING\n\t// ---------------------\n\n\t#ifdef highlight_point\n\t\tif (enablePointHighlighting && abs(mPosition.x - highlightedPointCoordinate.x) < 0.0001 &&\n\t\t\tabs(mPosition.y - highlightedPointCoordinate.y) < 0.0001 &&\n\t\t\tabs(mPosition.z - highlightedPointCoordinate.z) < 0.0001) {\n\t\t\tvHighlight = 1.0;\n\t\t\tgl_PointSize = pointSize * highlightedPointScale;\n\t\t} else {\n\t\t\tvHighlight = 0.0;\n\t\t}\n\t#endif\n\n\t// ---------------------\n\t// OPACITY\n\t// ---------------------\n\n\t#ifndef color_type_point_index\n\t\t#ifdef attenuated_opacity\n\t\t\tvOpacity = opacity * exp(-length(-mvPosition.xyz) / opacityAttenuation);\n\t\t#else\n\t\t\tvOpacity = opacity;\n\t\t#endif\n\t#endif\n\n\t// ---------------------\n\t// FILTERING\n\t// ---------------------\n\n\t#ifdef use_filter_by_normal\n\t\tif(abs((modelViewMatrix * vec4(normal, 0.0)).z) > filterByNormalThreshold) {\n\t\t\t// Move point outside clip space space to discard it.\n\t\t\tgl_Position = vec4(0.0, 0.0, 2.0, 1.0);\n\t\t}\n\t#endif\n\n\t// ---------------------\n\t// POINT COLOR\n\t// ---------------------\n\n\t#ifdef color_type_rgb\n\t\tvColor = getRGB();\n\t#elif defined color_type_height\n\t\tvColor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tvColor = (1.0 - transition) * getRGB() + transition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = -mvPosition.z ;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tvColor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tvColor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tvColor = texture(gradient, vec2(w, 1.0 - w)).rgb;\n\t#elif defined color_type_color\n\t\tvColor = uColor;\n\t#elif defined color_type_lod\n\tfloat w = getLOD() / 10.0;\n\tvColor = texture(gradient, vec2(w, 1.0 - w)).rgb;\n\t#elif defined color_type_point_index\n\t\tvColor = indices.rgb;\n\t#elif defined color_type_classification\n\t  vec4 cl = getClassification();\n\t\tvColor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tvColor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tvColor = getSourceID();\n\t#elif defined color_type_normal\n\t\tvColor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tvColor = color;\n\t#elif defined color_type_composite\n\t\tvColor = getCompositeColor();\n\t#endif\n\n\t// #if !defined color_type_composite && defined color_type_classification\n\t// \tif (cl.a == 0.0) {\n\t// \t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t// \t\treturn;\n\t// \t}\n\t// #endif\n\n\t// ---------------------\n\t// CLIPPING\n\t// ---------------------\n\n\t// #if defined use_clip_box\n\t// \tbool insideAny = false;\n\t// \tfor (int i = 0; i < max_clip_boxes; i++) {\n\t// \t\tif (i == int(clipBoxCount)) {\n\t// \t\t\tbreak;\n\t// \t\t}\n\n\t// \t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4(position, 1.0);\n\t// \t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t// \t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t// \t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\t// \t\tinsideAny = insideAny || inside;\n\t// \t}\n\n\t// \tif (!insideAny) {\n\t// \t\t#if defined clip_outside\n\t// \t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n\t// \t\t#elif defined clip_highlight_inside && !defined(color_type_depth)\n\t// \t\t\tfloat c = (vColor.r + vColor.g + vColor.b) / 6.0;\n\t// \t\t#endif\n\t// \t} else {\n\t// \t\t#if defined clip_highlight_inside\n\t// \t\t\tvColor.r += 0.5;\n\t// \t\t#endif\n\t// \t}\n\t// #endif\n\n\t// #if NUM_CLIP_PLANES > 0\n\t// \tvec4 plane;\n\t// \tvec3 vClipPosition = -(modelMatrix * vec4(position, 1.0)).xyz;\n\t// \tfor (int i = 0; i < NUM_CLIP_PLANES; i++) {\n\t// \t\tplane = clippingPlanes[i];\n\t// \t\tif (dot(vClipPosition, plane.xyz) > plane.w) {\n\t// \t\t\tgl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n\t// \t\t};\n\t// \t}\n\t// #endif\n}\n"},477:t=>{"use strict";t.exports=function(t,e,n,i){var u=self||window;try{try{var o;try{o=new u.Blob([t])}catch(e){(o=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(t),o=o.getBlob()}var r=u.URL||u.webkitURL,s=r.createObjectURL(o),a=new u[e](s,n);return r.revokeObjectURL(s),a}catch(i){return new u[e]("data:application/javascript,".concat(encodeURIComponent(t)),n)}}catch(t){if(!i)throw Error("Inline worker is not supported");return new u[e](i,n)}}},881:e=>{"use strict";e.exports=t}},n={};function i(t){var u=n[t];if(void 0!==u)return u.exports;var o=n[t]={exports:{}};return e[t].call(o.exports,o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var u={};return(()=>{"use strict";i.r(u),i.d(u,{BlurMaterial:()=>l,ClipMode:()=>t,GRAYSCALE:()=>A,INFERNO:()=>g,PLASMA:()=>F,POINT_ATTRIBUTES:()=>W,POINT_ATTRIBUTE_TYPES:()=>V,PointAttributeName:()=>G,PointAttributes:()=>j,PointCloudMaterial:()=>O,PointCloudOctree:()=>nt,PointCloudOctreeGeometry:()=>$,PointCloudOctreeGeometryNode:()=>q,PointCloudOctreeNode:()=>Q,PointCloudOctreePicker:()=>tt,PointCloudTree:()=>et,PointColorType:()=>s,PointOpacityType:()=>r,PointShape:()=>n,PointSizeType:()=>e,Potree:()=>gt,QueueItem:()=>At,RAINBOW:()=>m,SPECTRAL:()=>E,TreeType:()=>o,VIRIDIS:()=>v,Version:()=>Ft,YELLOW_GREEN:()=>B,generateClassificationTexture:()=>_,generateDataTexture:()=>y,generateGradientTexture:()=>x});var t,e,n,o,r,s,a=i(881);class l extends a.ShaderMaterial{constructor(){super(...arguments),this.vertexShader=i(412),this.fragmentShader=i(913),this.uniforms={screenWidth:{type:"f",value:0},screenHeight:{type:"f",value:0},map:{type:"t",value:null}}}}!function(t){t[t.DISABLED=0]="DISABLED",t[t.CLIP_OUTSIDE=1]="CLIP_OUTSIDE",t[t.HIGHLIGHT_INSIDE=2]="HIGHLIGHT_INSIDE"}(t||(t={})),function(t){t[t.FIXED=0]="FIXED",t[t.ATTENUATED=1]="ATTENUATED",t[t.ADAPTIVE=2]="ADAPTIVE"}(e||(e={})),function(t){t[t.SQUARE=0]="SQUARE",t[t.CIRCLE=1]="CIRCLE",t[t.PARABOLOID=2]="PARABOLOID"}(n||(n={})),function(t){t[t.OCTREE=0]="OCTREE",t[t.KDTREE=1]="KDTREE"}(o||(o={})),function(t){t[t.FIXED=0]="FIXED",t[t.ATTENUATED=1]="ATTENUATED"}(r||(r={})),function(t){t[t.RGB=0]="RGB",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.HEIGHT=3]="HEIGHT",t[t.ELEVATION=3]="ELEVATION",t[t.INTENSITY=4]="INTENSITY",t[t.INTENSITY_GRADIENT=5]="INTENSITY_GRADIENT",t[t.LOD=6]="LOD",t[t.LEVEL_OF_DETAIL=6]="LEVEL_OF_DETAIL",t[t.POINT_INDEX=7]="POINT_INDEX",t[t.CLASSIFICATION=8]="CLASSIFICATION",t[t.RETURN_NUMBER=9]="RETURN_NUMBER",t[t.SOURCE=10]="SOURCE",t[t.NORMAL=11]="NORMAL",t[t.PHONG=12]="PHONG",t[t.RGB_HEIGHT=13]="RGB_HEIGHT",t[t.COMPOSITE=50]="COMPOSITE"}(s||(s={}));const c="PerspectiveCamera",D=new a.Color(0,0,0),d=new a.Vector4(1,0,0,1);function f(t){return parseInt(t.charAt(t.length-1),10)||0}function p(t,e){const n=t.name,i=e.name;return n.length!==i.length?n.length-i.length:n<i?-1:n>i?1:0}function h(t){return t.replace("gs://","https://storage.googleapis.com/")}const C={0:new a.Vector4(.5,.5,.5,1),1:new a.Vector4(.5,.5,.5,1),2:new a.Vector4(.63,.32,.18,1),3:new a.Vector4(0,1,0,1),4:new a.Vector4(0,.8,0,1),5:new a.Vector4(0,.6,0,1),6:new a.Vector4(1,.66,0,1),7:new a.Vector4(1,0,1,1),8:new a.Vector4(1,0,0,1),9:new a.Vector4(0,0,1,1),12:new a.Vector4(1,1,0,1),DEFAULT:new a.Vector4(.3,.6,.6,.5)},A=[[0,new a.Color(0,0,0)],[1,new a.Color(1,1,1)]],g=[[0,new a.Color(.077,.042,.206)],[.1,new a.Color(.225,.036,.388)],[.2,new a.Color(.373,.074,.432)],[.3,new a.Color(.522,.128,.42)],[.4,new a.Color(.665,.182,.37)],[.5,new a.Color(.797,.255,.287)],[.6,new a.Color(.902,.364,.184)],[.7,new a.Color(.969,.516,.063)],[.8,new a.Color(.988,.683,.072)],[.9,new a.Color(.961,.859,.298)],[1,new a.Color(.988,.998,.645)]],F=[[0,new a.Color(.241,.015,.61)],[.1,new a.Color(.387,.001,.654)],[.2,new a.Color(.524,.025,.653)],[.3,new a.Color(.651,.125,.596)],[.4,new a.Color(.752,.227,.513)],[.5,new a.Color(.837,.329,.431)],[.6,new a.Color(.907,.435,.353)],[.7,new a.Color(.963,.554,.272)],[.8,new a.Color(.992,.681,.195)],[.9,new a.Color(.987,.822,.144)],[1,new a.Color(.94,.975,.131)]],m=[[0,new a.Color(.278,0,.714)],[1/6,new a.Color(0,0,1)],[2/6,new a.Color(0,1,1)],[.5,new a.Color(0,1,0)],[4/6,new a.Color(1,1,0)],[5/6,new a.Color(1,.64,0)],[1,new a.Color(1,0,0)]],E=[[0,new a.Color(.3686,.3098,.6353)],[.1,new a.Color(.1961,.5333,.7412)],[.2,new a.Color(.4,.7608,.6471)],[.3,new a.Color(.6706,.8667,.6431)],[.4,new a.Color(.902,.9608,.5961)],[.5,new a.Color(1,1,.749)],[.6,new a.Color(.9961,.8784,.5451)],[.7,new a.Color(.9922,.6824,.3804)],[.8,new a.Color(.9569,.4275,.2627)],[.9,new a.Color(.8353,.2431,.3098)],[1,new a.Color(.6196,.0039,.2588)]],v=[[0,new a.Color(.267,.005,.329)],[.1,new a.Color(.283,.141,.458)],[.2,new a.Color(.254,.265,.53)],[.3,new a.Color(.207,.372,.553)],[.4,new a.Color(.164,.471,.558)],[.5,new a.Color(.128,.567,.551)],[.6,new a.Color(.135,.659,.518)],[.7,new a.Color(.267,.749,.441)],[.8,new a.Color(.478,.821,.318)],[.9,new a.Color(.741,.873,.15)],[1,new a.Color(.993,.906,.144)]],B=[[0,new a.Color(.1647,.2824,.3451)],[.1,new a.Color(.1338,.3555,.4227)],[.2,new a.Color(.061,.4319,.4864)],[.3,new a.Color(0,.5099,.5319)],[.4,new a.Color(0,.5881,.5569)],[.5,new a.Color(.137,.665,.5614)],[.6,new a.Color(.2906,.7395,.5477)],[.7,new a.Color(.4453,.8099,.5201)],[.8,new a.Color(.6102,.8748,.485)],[.9,new a.Color(.7883,.9323,.4514)],[1,new a.Color(.9804,.9804,.4314)]];function y(t,e,n){const i=t*e,u=new Uint8Array(4*i),o=Math.floor(255*n.r),r=Math.floor(255*n.g),s=Math.floor(255*n.b);for(let t=0;t<i;t++)u[3*t]=o,u[3*t+1]=r,u[3*t+2]=s;const l=new a.DataTexture(u,t,e,a.RGBAFormat);return l.needsUpdate=!0,l.magFilter=a.NearestFilter,l}function x(t){const e=64,n=document.createElement("canvas");n.width=e,n.height=e;const i=n.getContext("2d");i.rect(0,0,e,e);const u=i.createLinearGradient(0,0,e,e);for(let e=0;e<t.length;e++){const n=t[e];u.addColorStop(n[0],`#${n[1].getHexString()}`)}i.fillStyle=u,i.fill();const o=new a.CanvasTexture(n);return o.needsUpdate=!0,o.minFilter=a.LinearFilter,o}function _(t){const e=new Uint8Array(262144);for(let n=0;n<256;n++)for(let i=0;i<256;i++){const u=n+256*i;let o;o=t[n]?t[n]:t[n%32]?t[n%32]:t.DEFAULT,e[4*u+0]=255*o.x,e[4*u+1]=255*o.y,e[4*u+2]=255*o.z,e[4*u+3]=255*o.w}const n=new a.DataTexture(e,256,256,a.RGBAFormat);return n.magFilter=a.NearestFilter,n.needsUpdate=!0,n}var b=function(t,e,n,i){var u,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(u=t[s])&&(r=(o<3?u(r):o>3?u(e,n,r):u(e,n))||r);return o>3&&r&&Object.defineProperty(e,n,r),r};const w={[o.OCTREE]:"tree_type_octree",[o.KDTREE]:"tree_type_kdtree"},T={[e.FIXED]:"fixed_point_size",[e.ATTENUATED]:"attenuated_point_size",[e.ADAPTIVE]:"adaptive_point_size"},S={[r.ATTENUATED]:"attenuated_opacity",[r.FIXED]:"fixed_opacity"},P={[n.SQUARE]:"square_point_shape",[n.CIRCLE]:"circle_point_shape",[n.PARABOLOID]:"paraboloid_point_shape"},N={[s.RGB]:"color_type_rgb",[s.COLOR]:"color_type_color",[s.DEPTH]:"color_type_depth",[s.HEIGHT]:"color_type_height",[s.INTENSITY]:"color_type_intensity",[s.INTENSITY_GRADIENT]:"color_type_intensity_gradient",[s.LOD]:"color_type_lod",[s.POINT_INDEX]:"color_type_point_index",[s.CLASSIFICATION]:"color_type_classification",[s.RETURN_NUMBER]:"color_type_return_number",[s.SOURCE]:"color_type_source",[s.NORMAL]:"color_type_normal",[s.PHONG]:"color_type_phong",[s.RGB_HEIGHT]:"color_type_rgb_height",[s.COMPOSITE]:"color_type_composite"},I={[t.DISABLED]:"clip_disabled",[t.CLIP_OUTSIDE]:"clip_outside",[t.HIGHLIGHT_INSIDE]:"clip_highlight_inside"};class O extends a.RawShaderMaterial{constructor(i={}){super(),this.lights=!1,this.fog=!1,this.numClipBoxes=0,this.clipBoxes=[],this.visibleNodeTextureOffsets=new Map,this._gradient=E,this.gradientTexture=x(this._gradient),this._classification=C,this.classificationTexture=_(this._classification),this.defines={NUM_CLIP_PLANES:0},this.uniforms={bbSize:L("fv",[0,0,0]),blendDepthSupplement:L("f",0),blendHardness:L("f",2),classificationLUT:L("t",this.classificationTexture||new a.Texture),clipBoxCount:L("f",0),clipBoxes:L("Matrix4fv",[]),clipping:L("b",!0),numClippingPlanes:L("f",0),clippingPlanes:L("fv",[]),depthMap:L("t",null),diffuse:L("fv",[1,1,1]),fov:L("f",1),gradient:L("t",this.gradientTexture||new a.Texture),heightMax:L("f",1),heightMin:L("f",0),intensityBrightness:L("f",0),intensityContrast:L("f",0),intensityGamma:L("f",1),intensityRange:L("fv",[0,65e3]),isLeafNode:L("b",0),level:L("f",0),maxSize:L("f",50),minSize:L("f",2),octreeSize:L("f",0),opacity:L("f",1),pcIndex:L("f",0),rgbBrightness:L("f",0),rgbContrast:L("f",0),rgbGamma:L("f",1),screenHeight:L("f",1),screenWidth:L("f",1),size:L("f",1),spacing:L("f",1),toModel:L("Matrix4f",[]),transition:L("f",.5),uColor:L("c",new a.Color(16777215)),visibleNodes:L("t",this.visibleNodesTexture||new a.Texture),vnStart:L("f",0),wClassification:L("f",0),wElevation:L("f",0),wIntensity:L("f",0),wReturnNumber:L("f",0),wRGB:L("f",1),wSourceID:L("f",0),opacityAttenuation:L("f",1),filterByNormalThreshold:L("f",0),highlightedPointCoordinate:L("fv",new a.Vector3),highlightedPointColor:L("fv",d.clone()),enablePointHighlighting:L("b",!0),highlightedPointScale:L("f",2)},this.useClipBox=!1,this.weighted=!1,this.pointColorType=s.RGB,this.pointSizeType=e.ADAPTIVE,this.clipMode=t.DISABLED,this.useEDL=!1,this.shape=n.SQUARE,this.treeType=o.OCTREE,this.pointOpacityType=r.FIXED,this.useFilterByNormal=!1,this.highlightPoint=!1,this.attributes={position:{type:"fv",value:[]},color:{type:"fv",value:[]},normal:{type:"fv",value:[]},intensity:{type:"f",value:[]},classification:{type:"f",value:[]},returnNumber:{type:"f",value:[]},numberOfReturns:{type:"f",value:[]},pointSourceID:{type:"f",value:[]},indices:{type:"fv",value:[]}},this.setValues({defines:this.defines,glslVersion:a.GLSL3});const u=this.visibleNodesTexture=y(2048,1,new a.Color(16777215));u.minFilter=a.NearestFilter,u.magFilter=a.NearestFilter,this.setUniform("visibleNodes",u),this.treeType=M(i.treeType,o.OCTREE),this.size=M(i.size,1),this.minSize=M(i.minSize,2),this.maxSize=M(i.maxSize,50),this.classification=C,this.defaultAttributeValues.normal=[0,0,0],this.defaultAttributeValues.classification=[0,0,0],this.defaultAttributeValues.indices=[0,0,0,0],this.vertexColors=!0,this.updateShaderSource()}dispose(){super.dispose(),this.gradientTexture&&(this.gradientTexture.dispose(),this.gradientTexture=void 0),this.visibleNodesTexture&&(this.visibleNodesTexture.dispose(),this.visibleNodesTexture=void 0),this.clearVisibleNodeTextureOffsets(),this.classificationTexture&&(this.classificationTexture.dispose(),this.classificationTexture=void 0),this.depthMap&&(this.depthMap.dispose(),this.depthMap=void 0)}clearVisibleNodeTextureOffsets(){this.visibleNodeTextureOffsets.clear()}updateShaderSource(){this.vertexShader=this.applyDefines(i(59).Z),this.fragmentShader=this.applyDefines(i(53).Z),1===this.opacity?(this.blending=a.NoBlending,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.depthFunc=a.LessEqualDepth):this.opacity<1&&!this.useEDL&&(this.blending=a.AdditiveBlending,this.transparent=!0,this.depthTest=!1,this.depthWrite=!0),this.weighted&&(this.blending=a.AdditiveBlending,this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.depthFunc=a.LessEqualDepth),this.needsUpdate=!0}applyDefines(t){const e=[];function n(t){t&&e.push(`#define ${t}`)}return n(w[this.treeType]),n(T[this.pointSizeType]),n(P[this.shape]),n(N[this.pointColorType]),n(I[this.clipMode]),n(S[this.pointOpacityType]),1===this.rgbGamma&&0===this.rgbBrightness&&0===this.rgbContrast||n("use_rgb_gamma_contrast_brightness"),this.useFilterByNormal&&n("use_filter_by_normal"),this.useEDL&&n("use_edl"),this.weighted&&n("weighted_splats"),this.numClipBoxes>0&&n("use_clip_box"),this.highlightPoint&&n("highlight_point"),n("MAX_POINT_LIGHTS 0"),n("MAX_DIR_LIGHTS 0"),e.push(t),e.join("\n")}setClipBoxes(t){if(!t)return;this.clipBoxes=t;const e=this.numClipBoxes!==t.length&&(0===t.length||0===this.numClipBoxes);this.numClipBoxes=t.length,this.setUniform("clipBoxCount",this.numClipBoxes),e&&this.updateShaderSource();const n=16*this.numClipBoxes,i=new Float32Array(n);for(let e=0;e<this.numClipBoxes;e++)i.set(t[e].inverse.elements,16*e);for(let t=0;t<n;t++)isNaN(i[t])&&(i[t]=1/0);this.setUniform("clipBoxes",i)}get gradient(){return this._gradient}set gradient(t){this._gradient!==t&&(this._gradient=t,this.gradientTexture=x(this._gradient),this.setUniform("gradient",this.gradientTexture))}get classification(){return this._classification}set classification(t){const e={};for(const n of Object.keys(t))e[n]=t[n].clone();let n=!1;if(void 0===this._classification)n=!1;else{n=Object.keys(e).length===Object.keys(this._classification).length;for(const t of Object.keys(e))n=n&&void 0!==this._classification[t],n=n&&e[t].equals(this._classification[t])}n||(this._classification=e,this.recomputeClassification())}recomputeClassification(){this.classificationTexture=_(this._classification),this.setUniform("classificationLUT",this.classificationTexture)}get elevationRange(){return[this.heightMin,this.heightMax]}set elevationRange(t){this.heightMin=t[0],this.heightMax=t[1]}getUniform(t){return void 0===this.uniforms?void 0:this.uniforms[t].value}setUniform(t,e){if(void 0===this.uniforms)return;const n=this.uniforms[t];"c"===n.type?n.value.copy(e):e!==n.value&&(n.value=e)}updateMaterial(t,n,i,u){const o=u.getPixelRatio();i.type===c?this.fov=i.fov*(Math.PI/180):this.fov=Math.PI/2;const r=u.getRenderTarget();null!==r&&r instanceof a.WebGLRenderTarget?(this.screenWidth=r.width,this.screenHeight=r.height):(this.screenWidth=u.domElement.clientWidth*o,this.screenHeight=u.domElement.clientHeight*o);const l=Math.max(t.scale.x,t.scale.y,t.scale.z);this.spacing=t.pcoGeometry.spacing*l,this.octreeSize=t.pcoGeometry.boundingBox.getSize(O.helperVec3).x,this.pointSizeType!==e.ADAPTIVE&&this.pointColorType!==s.LOD||this.updateVisibilityTextureData(n)}updateVisibilityTextureData(t){t.sort(p);const e=new Uint8Array(4*t.length),n=new Array(t.length).fill(1/0);this.visibleNodeTextureOffsets.clear();for(let i=0;i<t.length;i++){const u=t[i];if(this.visibleNodeTextureOffsets.set(u.name,i),i>0){const t=u.name.slice(0,-1),o=this.visibleNodeTextureOffsets.get(t),r=i-o;n[o]=Math.min(n[o],r);const s=4*o;e[s]=e[s]|1<<u.index,e[s+1]=n[o]>>8,e[s+2]=n[o]%256}e[4*i+3]=u.name.length}const i=this.visibleNodesTexture;i&&(i.image.data.set(e),i.needsUpdate=!0)}static makeOnBeforeRender(t,e,n){return(i,u,o,r,s)=>{const a=s,l=a.uniforms;if(s.clippingPlanes&&s.clippingPlanes.length>0){const t=s.clippingPlanes,e=new Array(4*s.clippingPlanes.length);for(let n=0;n<t.length;n++)e[4*n+0]=t[n].normal.x,e[4*n+1]=t[n].normal.y,e[4*n+2]=t[n].normal.z,e[4*n+3]=t[n].constant;l.clippingPlanes.value=e}a.defines.NUM_CLIP_PLANES=s.clippingPlanes.length,l.level.value=e.level,l.isLeafNode.value=e.isLeafNode;const c=a.visibleNodeTextureOffsets.get(e.name);void 0!==c&&(l.vnStart.value=c),l.pcIndex.value=void 0!==n?n:t.visibleNodes.indexOf(e),s.uniformsNeedUpdate=!0}}}function L(t,e){return{type:t,value:e}}function M(t,e){return void 0===t?e:t}function R(t,e=!1){return(n,i)=>{Object.defineProperty(n,i,{get(){return this.getUniform(t)},set(n){n!==this.getUniform(t)&&(this.setUniform(t,n),e&&this.updateShaderSource())}})}}function z(){return(t,e)=>{const n=`_${e.toString()}`;Object.defineProperty(t,e,{get(){return this[n]},set(t){t!==this[n]&&(this[n]=t,this.updateShaderSource())}})}}var G,U;O.helperVec3=new a.Vector3,b([R("bbSize")],O.prototype,"bbSize",void 0),b([R("depthMap")],O.prototype,"depthMap",void 0),b([R("fov")],O.prototype,"fov",void 0),b([R("heightMax")],O.prototype,"heightMax",void 0),b([R("heightMin")],O.prototype,"heightMin",void 0),b([R("intensityBrightness")],O.prototype,"intensityBrightness",void 0),b([R("intensityContrast")],O.prototype,"intensityContrast",void 0),b([R("intensityGamma")],O.prototype,"intensityGamma",void 0),b([R("intensityRange")],O.prototype,"intensityRange",void 0),b([R("maxSize")],O.prototype,"maxSize",void 0),b([R("minSize")],O.prototype,"minSize",void 0),b([R("octreeSize")],O.prototype,"octreeSize",void 0),b([R("opacity",!0)],O.prototype,"opacity",void 0),b([R("rgbBrightness",!0)],O.prototype,"rgbBrightness",void 0),b([R("rgbContrast",!0)],O.prototype,"rgbContrast",void 0),b([R("rgbGamma",!0)],O.prototype,"rgbGamma",void 0),b([R("screenHeight")],O.prototype,"screenHeight",void 0),b([R("screenWidth")],O.prototype,"screenWidth",void 0),b([R("size")],O.prototype,"size",void 0),b([R("spacing")],O.prototype,"spacing",void 0),b([R("transition")],O.prototype,"transition",void 0),b([R("uColor")],O.prototype,"color",void 0),b([R("wClassification")],O.prototype,"weightClassification",void 0),b([R("wElevation")],O.prototype,"weightElevation",void 0),b([R("wIntensity")],O.prototype,"weightIntensity",void 0),b([R("wReturnNumber")],O.prototype,"weightReturnNumber",void 0),b([R("wRGB")],O.prototype,"weightRGB",void 0),b([R("wSourceID")],O.prototype,"weightSourceID",void 0),b([R("opacityAttenuation")],O.prototype,"opacityAttenuation",void 0),b([R("filterByNormalThreshold")],O.prototype,"filterByNormalThreshold",void 0),b([R("highlightedPointCoordinate")],O.prototype,"highlightedPointCoordinate",void 0),b([R("highlightedPointColor")],O.prototype,"highlightedPointColor",void 0),b([R("enablePointHighlighting")],O.prototype,"enablePointHighlighting",void 0),b([R("highlightedPointScale")],O.prototype,"highlightedPointScale",void 0),b([z()],O.prototype,"useClipBox",void 0),b([z()],O.prototype,"weighted",void 0),b([z()],O.prototype,"pointColorType",void 0),b([z()],O.prototype,"pointSizeType",void 0),b([z()],O.prototype,"clipMode",void 0),b([z()],O.prototype,"useEDL",void 0),b([z()],O.prototype,"shape",void 0),b([z()],O.prototype,"treeType",void 0),b([z()],O.prototype,"pointOpacityType",void 0),b([z()],O.prototype,"useFilterByNormal",void 0),b([z()],O.prototype,"highlightPoint",void 0),(U=G||(G={}))[U.POSITION_CARTESIAN=0]="POSITION_CARTESIAN",U[U.COLOR_PACKED=1]="COLOR_PACKED",U[U.COLOR_FLOATS_1=2]="COLOR_FLOATS_1",U[U.COLOR_FLOATS_255=3]="COLOR_FLOATS_255",U[U.NORMAL_FLOATS=4]="NORMAL_FLOATS",U[U.FILLER=5]="FILLER",U[U.INTENSITY=6]="INTENSITY",U[U.CLASSIFICATION=7]="CLASSIFICATION",U[U.NORMAL_SPHEREMAPPED=8]="NORMAL_SPHEREMAPPED",U[U.NORMAL_OCT16=9]="NORMAL_OCT16",U[U.NORMAL=10]="NORMAL";const V={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}};function H(t,e,n){return{name:t,type:e,numElements:n,byteSize:n*e.size}}const k=H(G.COLOR_PACKED,V.DATA_TYPE_INT8,4),W={POSITION_CARTESIAN:H(G.POSITION_CARTESIAN,V.DATA_TYPE_FLOAT,3),RGBA_PACKED:k,COLOR_PACKED:k,RGB_PACKED:H(G.COLOR_PACKED,V.DATA_TYPE_INT8,3),NORMAL_FLOATS:H(G.NORMAL_FLOATS,V.DATA_TYPE_FLOAT,3),FILLER_1B:H(G.FILLER,V.DATA_TYPE_UINT8,1),INTENSITY:H(G.INTENSITY,V.DATA_TYPE_UINT16,1),CLASSIFICATION:H(G.CLASSIFICATION,V.DATA_TYPE_UINT8,1),NORMAL_SPHEREMAPPED:H(G.NORMAL_SPHEREMAPPED,V.DATA_TYPE_UINT8,2),NORMAL_OCT16:H(G.NORMAL_OCT16,V.DATA_TYPE_UINT8,2),NORMAL:H(G.NORMAL,V.DATA_TYPE_FLOAT,3)};class j{constructor(t=[]){this.attributes=[],this.byteSize=0,this.size=0;for(let e=0;e<t.length;e++){const n=t[e],i=W[n];this.attributes.push(i),this.byteSize+=i.byteSize,this.size++}}add(t){this.attributes.push(t),this.byteSize+=t.byteSize,this.size++}hasColors(){return void 0!==this.attributes.find(X)}hasNormals(){return void 0!==this.attributes.find(Y)}}function X({name:t}){return t===G.COLOR_PACKED}function Y({name:t}){return t===G.NORMAL_SPHEREMAPPED||t===G.NORMAL_FLOATS||t===G.NORMAL||t===G.NORMAL_OCT16}function K(t,e){return(new a.Box3).setFromPoints([new a.Vector3(t.min.x,t.min.y,t.min.z).applyMatrix4(e),new a.Vector3(t.min.x,t.min.y,t.min.z).applyMatrix4(e),new a.Vector3(t.max.x,t.min.y,t.min.z).applyMatrix4(e),new a.Vector3(t.min.x,t.max.y,t.min.z).applyMatrix4(e),new a.Vector3(t.min.x,t.min.y,t.max.z).applyMatrix4(e),new a.Vector3(t.min.x,t.max.y,t.max.z).applyMatrix4(e),new a.Vector3(t.max.x,t.max.y,t.min.z).applyMatrix4(e),new a.Vector3(t.max.x,t.min.y,t.max.z).applyMatrix4(e),new a.Vector3(t.max.x,t.max.y,t.max.z).applyMatrix4(e)])}const J=i(142);class q extends a.EventDispatcher{constructor(t,e,n,i){super(),this.id=q.idCount++,this.level=0,this.spacing=.2,this.hasChildren=!1,this.children=[null,null,null,null,null,null,null,null],this.hierarchyUrl="",this.mean=new a.Vector3,this.numPoints=5e4,this.loaded=!1,this.loading=!1,this.failed=!1,this.indexInList=0,this.parent=null,this.oneTimeDisposeHandlers=[],this.isLeafNode=!0,this.isTreeNode=!1,this.isGeometryNode=!0,this.name=t,this.index=f(t),this.indexInList=i,this.pcoGeometry=e,this.boundingBox=n,this.tightBoundingBox=n.clone(),this.boundingSphere=n.getBoundingSphere(new a.Sphere)}dispose(){this.geometry&&this.parent&&(this.geometry.dispose(),this.geometry=void 0,this.loaded=!1,this.oneTimeDisposeHandlers.forEach((t=>t())),this.oneTimeDisposeHandlers=[])}getUrl(){return[this.pcoGeometry.octreeDir].join("/")}addChild(t){this.children[t.index]=t,this.isLeafNode=!1,t.parent=this}traverse(t,e=!0){const n=e?[this]:[];let i;for(;void 0!==(i=n.pop());){t(i);for(const t of i.children)null!==t&&n.push(t)}}load(){if(!this.canLoad())return Promise.resolve();let t;return this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.needsUpdate=!0,t=this.loadPoints(),t.catch((t=>{throw this.loading=!1,this.failed=!0,this.pcoGeometry.numNodesLoading--,t}))}loadResonai(){if(!this.canLoad())return Promise.resolve();let t;return this.loading=!0,this.pcoGeometry.numNodesLoading++,this.pcoGeometry.needsUpdate=!0,this.level%this.pcoGeometry.hierarchyStepSize==0&&this.hasChildren?(console.log("here1"),t=this.loadResonaiHierachyThenPoints()):(console.log("here2"),t=this.loadResonaiPoints()),t.catch((t=>{throw this.loading=!1,this.failed=!0,this.pcoGeometry.numNodesLoading--,t}))}canLoad(){return!(this.loading||this.loaded||this.pcoGeometry.disposed||this.pcoGeometry.loader.disposed)}loadPoints(){return this.pcoGeometry.needsUpdate=!0,this.pcoGeometry.loader.load(this)}loadResonaiPoints(){return this.pcoGeometry.needsUpdate=!0,this.pcoGeometry.loader.load(this)}loadResonaiHierachyThenPoints(){return this.level%this.pcoGeometry.hierarchyStepSize!=0?Promise.resolve():Promise.resolve(fetch(this.hierarchyUrl).then((t=>{t.text().then((t=>{console.log(t),this.loadResonaiHierarchy(this,J.parse(t))}))})))}loadResonaiHierarchy(t,e){const n=this.getResonaiNodeData(t.name,0,e);t.numPoints=n.numPoints;const i=[n],u=[];e.nodes.forEach((t=>{const e=Number(t).toString(2).padStart(32,"0");console.log(e.slice(0,8),e.slice(8))}));let o=1;for(;i.length>0;){const t=i.shift();let n=128;for(let r=0;r<8;r++){if(0!=(t.children&n)){const n=this.getResonaiNodeData(t.name+"_"+r,o,e);o+=1,u.push(n),i.push(n)}n>>=1}}t.pcoGeometry.needsUpdate=!0;const r=new Map;r.set(t.name,t),u.forEach((e=>this.addNode(e,t.pcoGeometry,r))),t.loadResonaiPoints()}getResonaiNodeData(t,e,n){console.log("name:",t);const i=n.nodes[e],u=i>>>24;console.log("# children:",u);const o=16777215&i;return console.log("# numPoints:",o),{children:u,numPoints:o,name:t,indexInList:e}}addNode({name:t,numPoints:e,children:n,indexInList:i},u,o){const r=f(t),s=t.substring(0,t.length-2),l=o.get(s),c=(t.length+1)/2,D=function(t,e){const n=t.min.clone(),i=t.max.clone(),u=(new a.Vector3).subVectors(i,n);return(1&e)>0?n.z+=u.z/2:i.z-=u.z/2,(2&e)>0?n.y+=u.y/2:i.y-=u.y/2,(4&e)>0?n.x+=u.x/2:i.x-=u.x/2,new a.Box3(n,i)}(l.boundingBox,r),d=new q(t,u,D,i);d.level=c,d.numPoints=e,d.hasChildren=n>0,d.spacing=u.spacing/Math.pow(2,c),console.log(u.spacing,c,d.spacing),d.indexInList=i,l.addChild(d),o.set(t,d)}}q.idCount=0;class ${constructor(t,e,n,i,u){this.loader=t,this.boundingBox=e,this.tightBoundingBox=n,this.offset=i,this.xhrRequest=u,this.disposed=!1,this.needsUpdate=!0,this.octreeDir="",this.hierarchyStepSize=-1,this.nodes={},this.numNodesLoading=0,this.maxNumNodesLoading=3,this.spacing=.01,this.pointAttributes=new j([]),this.projection=null,this.url=null}dispose(){this.loader.dispose(),this.root.traverse((t=>t.dispose())),this.disposed=!0}addNodeLoadedCallback(t){this.loader.callbacks.push(t)}clearNodeLoadedCallbacks(){this.loader.callbacks=[]}}class Q extends a.EventDispatcher{constructor(t,e){super(),this.pcIndex=void 0,this.boundingBoxNode=null,this.loaded=!0,this.isTreeNode=!0,this.isGeometryNode=!1,this.geometryNode=t,this.sceneNode=e,this.children=t.children.slice()}dispose(){this.geometryNode.dispose()}disposeSceneNode(){const t=this.sceneNode;if(t.geometry instanceof a.BufferGeometry){const e=t.geometry.attributes;for(const t in e)"position"===t&&delete e[t].array,delete e[t];t.geometry.dispose(),t.geometry=void 0}}traverse(t,e){this.geometryNode.traverse(t,e)}get id(){return this.geometryNode.id}get name(){return this.geometryNode.name}get level(){return this.geometryNode.level}get isLeafNode(){return this.geometryNode.isLeafNode}get numPoints(){return this.geometryNode.numPoints}get index(){return this.geometryNode.index}get boundingSphere(){return this.geometryNode.boundingSphere}get boundingBox(){return this.geometryNode.boundingBox}get spacing(){return this.geometryNode.spacing}}function Z(t,e,n){return Math.min(Math.max(e,t),n)}class tt{dispose(){this.pickState&&(this.pickState.material.dispose(),this.pickState.renderTarget.dispose())}pick(t,e,n,i,u={}){if(0===i.length)return null;const o=this.pickState?this.pickState:this.pickState=tt.getPickState(),r=o.material,s=t.getPixelRatio(),a=Math.ceil(t.domElement.clientWidth*s),l=Math.ceil(t.domElement.clientHeight*s);tt.updatePickRenderTarget(this.pickState,a,l);const c=tt.helperVec3;u.pixelPosition?c.copy(u.pixelPosition):(c.addVectors(e.position,n.direction).project(e),c.x=(c.x+1)*a*.5,c.y=(c.y+1)*l*.5);const D=Math.floor((u.pickWindowSize||15)*s),d=(D-1)/2,f=Math.floor(Z(c.x-d,0,a)),p=Math.floor(Z(c.y-d,0,l));tt.prepareRender(t,f,p,D,r,o);const h=tt.render(t,e,r,i,n,o,u);r.clearVisibleNodeTextureOffsets();const C=tt.readPixels(t,f,p,D),A=tt.findHit(C,D);return tt.getPickPoint(A,h)}static prepareRender(t,e,n,i,u,o){t.setScissor(e,n,i,i),t.setScissorTest(!0),t.state.buffers.depth.setTest(u.depthTest),t.state.buffers.depth.setMask(u.depthWrite),t.state.setBlending(a.NoBlending),t.setRenderTarget(o.renderTarget),t.getClearColor(this.clearColor);const r=t.getClearAlpha();t.setClearColor(D,0),t.clear(!0,!0,!0),t.setClearColor(this.clearColor,r)}static render(t,e,n,i,u,o,r){const s=[];for(const a of i){const i=tt.nodesOnRay(a,u);i.length&&(tt.updatePickMaterial(n,a.material,r),n.updateMaterial(a,i,e,t),r.onBeforePickRender&&r.onBeforePickRender(n,o.renderTarget),o.scene.children=tt.createTempNodes(a,i,n,s.length),t.render(o.scene,e),i.forEach((t=>s.push({node:t,octree:a}))))}return s}static nodesOnRay(t,e){const n=[],i=e.clone();for(const e of t.visibleNodes){const u=tt.helperSphere.copy(e.boundingSphere).applyMatrix4(t.matrixWorld);i.intersectsSphere(u)&&n.push(e)}return n}static readPixels(t,e,n,i){const u=new Uint8Array(4*i*i);return t.readRenderTargetPixels(t.getRenderTarget(),e,n,i,i,u),t.setScissorTest(!1),t.setRenderTarget(null),u}static createTempNodes(t,e,n,i){const u=[];for(let o=0;o<e.length;o++){const r=e[o],s=r.sceneNode,l=new a.Points(s.geometry,n);l.matrix=s.matrix,l.matrixWorld=s.matrixWorld,l.matrixAutoUpdate=!1,l.frustumCulled=!1;const c=i+o+1;c>255&&console.error("More than 255 nodes for pick are not supported."),l.onBeforeRender=O.makeOnBeforeRender(t,r,c),u.push(l)}return u}static updatePickMaterial(e,n,i){e.pointSizeType=n.pointSizeType,e.shape=n.shape,e.size=n.size,e.minSize=n.minSize,e.maxSize=n.maxSize,e.classification=n.classification,e.useFilterByNormal=n.useFilterByNormal,e.filterByNormalThreshold=n.filterByNormalThreshold,i.pickOutsideClipRegion?e.clipMode=t.DISABLED:(e.clipMode=n.clipMode,e.setClipBoxes(n.clipMode===t.CLIP_OUTSIDE?n.clipBoxes:[]))}static updatePickRenderTarget(t,e,n){t.renderTarget.width===e&&t.renderTarget.height===n||(t.renderTarget.dispose(),t.renderTarget=tt.makePickRenderTarget(),t.renderTarget.setSize(e,n))}static makePickRenderTarget(){return new a.WebGLRenderTarget(1,1,{minFilter:a.LinearFilter,magFilter:a.NearestFilter,format:a.RGBAFormat})}static findHit(t,e){const n=new Uint32Array(t.buffer);let i=Number.MAX_VALUE,u=null;for(let o=0;o<e;o++)for(let r=0;r<e;r++){const s=o+r*e,a=Math.pow(o-(e-1)/2,2)+Math.pow(r-(e-1)/2,2),l=t[4*s+3];t[4*s+3]=0;const c=n[s];l>0&&a<i&&(u={pIndex:c,pcIndex:l-1},i=a)}return u}static getPickPoint(t,e){if(!t)return null;const n={},i=e[t.pcIndex]&&e[t.pcIndex].node.sceneNode;if(!i)return null;n.pointCloud=e[t.pcIndex].octree;const u=i.geometry.attributes;for(const e in u){if(!u.hasOwnProperty(e))continue;const o=u[e];if("position"===e)tt.addPositionToPickPoint(n,t,o,i);else if("normal"===e)tt.addNormalToPickPoint(n,t,o,i);else if("indices"===e);else if(1===o.itemSize)n[e]=o.array[t.pIndex];else{const i=[];for(let e=0;e<o.itemSize;e++)i.push(o.array[o.itemSize*t.pIndex+e]);n[e]=i}}return n}static addPositionToPickPoint(t,e,n,i){t.position=(new a.Vector3).fromBufferAttribute(n,e.pIndex).applyMatrix4(i.matrixWorld)}static addNormalToPickPoint(t,e,n,i){const u=(new a.Vector3).fromBufferAttribute(n,e.pIndex),o=new a.Vector4(u.x,u.y,u.z,0).applyMatrix4(i.matrixWorld);u.set(o.x,o.y,o.z),t.normal=u}static getPickState(){const t=new a.Scene;t.autoUpdate=!1;const e=new O;return e.pointColorType=s.POINT_INDEX,{renderTarget:tt.makePickRenderTarget(),material:e,scene:t}}}tt.helperVec3=new a.Vector3,tt.helperSphere=new a.Sphere,tt.clearColor=new a.Color;class et extends a.Object3D{constructor(){super(...arguments),this.root=null}initialized(){return null!==this.root}}class nt extends et{constructor(t,e,n){super(),this.disposed=!1,this.level=0,this.maxLevel=1/0,this.minNodePixelSize=50,this.root=null,this.boundingBoxNodes=[],this.visibleNodes=[],this.visibleGeometry=[],this.numVisiblePoints=0,this.showBoundingBox=!1,this.visibleBounds=new a.Box3,this.name="",this.potree=t,this.root=e.root,this.pcoGeometry=e,this.boundingBox=e.boundingBox,this.boundingSphere=this.boundingBox.getBoundingSphere(new a.Sphere),this.position.copy(e.offset),this.updateMatrix(),this.material=n||new O,this.initMaterial(this.material)}initMaterial(t){this.updateMatrixWorld(!0);const{min:e,max:n}=K(this.pcoGeometry.tightBoundingBox||this.getBoundingBoxWorld(),this.matrixWorld),i=n.z-e.z;t.heightMin=e.z-.2*i,t.heightMax=n.z+.2*i}dispose(){this.root&&this.root.dispose(),this.pcoGeometry.root.traverse((t=>this.potree.lru.remove(t))),this.pcoGeometry.dispose(),this.material.dispose(),this.visibleNodes=[],this.visibleGeometry=[],this.picker&&(this.picker.dispose(),this.picker=void 0),this.disposed=!0}get pointSizeType(){return this.material.pointSizeType}set pointSizeType(t){this.material.pointSizeType=t}toTreeNode(t,e){const n=new a.Points(t.geometry,this.material),i=new Q(t,n);return n.name=t.name,n.frustumCulled=!1,n.onBeforeRender=O.makeOnBeforeRender(this,i),e?(e.sceneNode.add(n),e.children[t.index]=i,t.oneTimeDisposeHandlers.push((()=>{i.disposeSceneNode(),e.sceneNode.remove(i.sceneNode),e.children[t.index]=t}))):(this.root=i,this.add(n)),i}updateVisibleBounds(){const t=this.visibleBounds;t.min.set(1/0,1/0,1/0),t.max.set(-1/0,-1/0,-1/0);for(const e of this.visibleNodes)e.isLeafNode&&(t.expandByPoint(e.boundingBox.min),t.expandByPoint(e.boundingBox.max))}updateBoundingBoxes(){if(!this.showBoundingBox||!this.parent)return;let t=this.parent.getObjectByName("bbroot");t||(t=new a.Object3D,t.name="bbroot",this.parent.add(t));const e=[];for(const t of this.visibleNodes)void 0!==t.boundingBoxNode&&t.isLeafNode&&e.push(t.boundingBoxNode);t.children=e}updateMatrixWorld(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0)}hideDescendants(t){const e=[];for(n(t);e.length>0;){const t=e.shift();t.visible=!1,n(t)}function n(t){for(const n of t.children)n.visible&&e.push(n)}}moveToOrigin(){this.position.set(0,0,0),this.position.set(0,0,0).sub(this.getBoundingBoxWorld().getCenter(new a.Vector3))}moveToGroundPlane(){this.position.y+=-this.getBoundingBoxWorld().min.y}getBoundingBoxWorld(){return this.updateMatrixWorld(!0),K(this.boundingBox,this.matrixWorld)}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}pick(t,e,n,i={}){return this.picker=this.picker||new tt,this.picker.pick(t,e,n,[this],i)}get progress(){return 0===this.visibleGeometry.length?0:this.visibleNodes.length/this.visibleGeometry.length}}const it=document.createElement("canvas").getContext("webgl"),ut={SHADER_INTERPOLATION:ot("EXT_frag_depth")&&rt(8),SHADER_SPLATS:ot("EXT_frag_depth")&&ot("OES_texture_float")&&rt(8),SHADER_EDL:ot("OES_texture_float")&&rt(8),precision:function(){if(null===it)return"";const t=it.getShaderPrecisionFormat(it.VERTEX_SHADER,it.HIGH_FLOAT),e=it.getShaderPrecisionFormat(it.VERTEX_SHADER,it.MEDIUM_FLOAT),n=it.getShaderPrecisionFormat(it.FRAGMENT_SHADER,it.HIGH_FLOAT),i=it.getShaderPrecisionFormat(it.FRAGMENT_SHADER,it.MEDIUM_FLOAT),u=t&&n&&t.precision>0&&n.precision>0,o=e&&i&&e.precision>0&&i.precision>0;return u?"highp":o?"mediump":"lowp"}()};function ot(t){return null!==it&&Boolean(it.getExtension(t))}function rt(t){return null!==it&&it.getParameter(it.MAX_VARYING_VECTORS)>=t}var st=i(477),at=i.n(st);function lt(){return at()('(()=>{"use strict";var e,t={927:(e,t,r)=>{r.r(t),r.d(t,{handleMessage:()=>i});var o=r(881);const n=["0.0.3","0.0.4","0.0.5"],s={Uint32:{ArrayClass:Uint32Array,size:4},Uint8:{ArrayClass:Uint8Array,size:1},Float32:{ArrayClass:Float32Array,size:4}};function i(e){return t=this,r=void 0,a=function*(){try{const t=((e,{polygon:t=!1}={})=>{let{positionsType:r,facesType:i,colorsType:a,uvType:u,textureType:l,counts:f,headerLength:c}=(e=>{const t=Math.min(80,e.byteLength),r=String.fromCharCode.apply(null,new Uint8Array(e,0,t)).split("\\n")[0],o=r.match(/Resonai YBF version: (?<version>\\d\\.\\d\\.\\d).*/),i=o.groups.version;if(!o||!n.includes(i))throw console.log("YBF Header: ",r),new Error("Unknown or old YBF format => Not supported");const a="0.0.5"===i?5:3,u=s.Uint32,l=s.Float32,f=s.Uint32,c="0.0.3"===i?s.Float32:s.Uint8,y=s.Float32,p=s.Uint32;let d=(r.length+1)*s.Uint8.size;d%4!=0&&(console.error("ERROR: old YBT format, header is not aligned to 32bit memory, offset:",d),e=e.slice((r.length+1)*s.Uint8.size),d=0);const b=d+u.size*a,h=new u.ArrayClass(e,d,a);d+=u.size*a;const g=h[0]*l.size,A=h[1]*f.size,w=h[2]*c.size,v=5===a?h[3]*y.size:0,m=5===a?h[4]*p.size:0;if(0!==h[2]&&h[0]!==h[2]||0!==v&&h[0]/3!=h[3]/2||g+A+w+v+m+b!==e.byteLength)throw new Error("Bad YBF format, might be corrupted or deprecated");return{positionsType:l,facesType:f,colorsType:c,uvType:y,textureType:p,counts:h,headerLength:d}})(e);const y=5===f.length,p=new o.BufferGeometry;let d=[];y&&(d=new l.ArrayClass(e,c,f[4]),c+=f[4]*l.size);const b=new r.ArrayClass(e,c,f[0]);c+=f[0]*r.size;const h=new i.ArrayClass(e,c,f[1]);c+=f[1]*i.size;let g=[];y&&(g=new u.ArrayClass(e,c,f[3]),c+=f[3]*u.size);const A=new a.ArrayClass(e,c,f[2]);c+=f[2]*a.size;const w=new o.BufferAttribute(b,3);if(p.setAttribute("position",w),f[1]>0){const e=new o.BufferAttribute(h,1);p.setIndex(e)}else if(t){const e=p.attributes.position.array,t=[];for(let r=0;r<e.length;r+=3)t.push(e[r],e[r+2]);const r=earcut(t),n=new o.BufferAttribute(Uint32Array.from(r),1);p.setIndex(n)}if(f[2]&&p.setAttribute("color",new o.BufferAttribute(A,3,!0)),y&&f[3]>0){p.setAttribute("uv",new o.BufferAttribute(g,2));let e=0;for(let t=0;t<d.length;t++)p.addGroup(3*e,3*d[t],t),e+=d[t]}return p.sourceType="ybf",p})(e.data.buffer),r=new ArrayBuffer(4*t.attributes.position.count),i=new Uint32Array(r);for(let e=0;e<t.attributes.position.count;e++)i[e]=e;postMessage({indices:i,attributeBuffers:{position:{buffer:t.attributes.position.array},color:{buffer:t.attributes.color.array}}})}catch(e){console.log(e),postMessage({failed:!0})}},new((i=void 0)||(i=Promise))((function(e,o){function n(e){try{u(a.next(e))}catch(e){o(e)}}function s(e){try{u(a.throw(e))}catch(e){o(e)}}function u(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,s)}u((a=a.apply(t,r||[])).next())}));var t,r,i,a}},881:e=>{e.exports=__WEBPACK_EXTERNAL_MODULE__881__}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=o(927),onmessage=e.handleMessage})();',"Worker",void 0,void 0)}class ct{constructor({url:t,getUrl:e=(t=>Promise.resolve(t))}){this.disposed=!1,this.workers=[],this.getUrl=e,console.log("ybf-loader constructor:",t),this.url=t,this.callbacks=[]}dispose(){this.workers.forEach((t=>t.terminate())),this.workers=[],this.disposed=!0}load(t){return t.loaded||this.disposed?Promise.resolve():Promise.resolve(this.getUrl(t.name,t.indexInList)).then((t=>fetch(t,{mode:"cors"}))).then((t=>t.arrayBuffer())).then((e=>new Promise((n=>this.parse(t,e,n)))))}parse(t,e,n){if(this.disposed)return void n();const i=this.getWorker(),u=t.pcoGeometry.pointAttributes;i.onmessage=e=>{if(this.disposed)return void n();const u=e.data;if(u.failed)return t.failed=!0,this.releaseWorker(i),this.callbacks.forEach((e=>e(t))),void n();const o=t.geometry=t.geometry||new a.BufferGeometry;o.boundingBox=t.boundingBox,this.addBufferAttributes(o,u.attributeBuffers),this.addIndices(o,u.indices),t.mean=(new a.Vector3).fromArray([0,0,0]),o.computeBoundingBox(),t.tightBoundingBox=o.boundingBox,t.loaded=!0,t.loading=!1,t.failed=!1,t.pcoGeometry.numNodesLoading--,t.pcoGeometry.needsUpdate=!0,this.releaseWorker(i),this.callbacks.forEach((e=>e(t))),n()};const o={buffer:e,pointAttributes:u,min:t.boundingBox.min.toArray(),offset:t.pcoGeometry.offset.toArray(),spacing:t.spacing,hasChildren:t.hasChildren};i.postMessage(o,[o.buffer])}getWorker(){return this.workers.pop()||new lt}releaseWorker(t){this.workers.push(t)}addBufferAttributes(t,e){Object.keys(e).forEach((n=>{const i=e[n].buffer;"position"===n?t.setAttribute("position",new a.BufferAttribute(new Float32Array(i),3)):"color"===n&&t.setAttribute("color",new a.BufferAttribute(new Uint8Array(i),3,!0))}))}addIndices(t,e){const n=new a.Uint8BufferAttribute(e,4);n.normalized=!0,t.setAttribute("indices",n)}}function Dt(t){return null!=t&&t.isGeometryNode}function dt(t){return null!=t&&t.isTreeNode}var ft=i(689);class pt extends a.LineSegments{constructor(t,e=new a.Color(16776960)){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array([t.min.x,t.min.y,t.min.z,t.max.x,t.min.y,t.min.z,t.max.x,t.min.y,t.max.z,t.min.x,t.min.y,t.max.z,t.min.x,t.max.y,t.min.z,t.max.x,t.max.y,t.min.z,t.max.x,t.max.y,t.max.z,t.min.x,t.max.y,t.max.z]),u=new a.BufferGeometry;u.setIndex(new a.BufferAttribute(n,1)),u.setAttribute("position",new a.BufferAttribute(i,3)),super(u,new a.LineBasicMaterial({color:e}))}}class ht{constructor(t){this.node=t,this.next=null,this.previous=null}}class Ct{constructor(t=1e6){this.pointBudget=t,this.first=null,this.last=null,this.numPoints=0,this.items=new Map}get size(){return this.items.size}has(t){return this.items.has(t.id)}touch(t){if(!t.loaded)return;const e=this.items.get(t.id);e?this.touchExisting(e):this.addNew(t)}addNew(t){const e=new ht(t);e.previous=this.last,this.last=e,e.previous&&(e.previous.next=e),this.first||(this.first=e),this.items.set(t.id,e),this.numPoints+=t.numPoints}touchExisting(t){t.previous?t.next&&(t.previous.next=t.next,t.next.previous=t.previous,t.previous=this.last,t.next=null,this.last=t,t.previous&&(t.previous.next=t)):t.next&&(this.first=t.next,this.first.previous=null,t.previous=this.last,t.next=null,this.last=t,t.previous&&(t.previous.next=t))}remove(t){const e=this.items.get(t.id);e&&(1===this.items.size?(this.first=null,this.last=null):(e.previous||(this.first=e.next,this.first.previous=null),e.next||(this.last=e.previous,this.last.next=null),e.previous&&e.next&&(e.previous.next=e.next,e.next.previous=e.previous)),this.items.delete(t.id),this.numPoints-=t.numPoints)}getLRUItem(){return this.first?this.first.node:void 0}freeMemory(){if(!(this.items.size<=1))for(;this.numPoints>2*this.pointBudget;){const t=this.getLRUItem();t&&this.disposeSubtree(t)}}disposeSubtree(t){const e=[t];t.traverse((t=>{t.loaded&&e.push(t)}));for(const t of e)t.dispose(),this.remove(t)}}class At{constructor(t,e,n,i){this.pointCloudIndex=t,this.weight=e,this.node=n,this.parent=i}}class gt{constructor(){this._pointBudget=1e6,this._rendererSize=new a.Vector2,this.maxNumNodesLoading=4,this.features=ut,this.lru=new Ct(this._pointBudget),this.updateVisibilityStructures=(()=>{const t=new a.Matrix4,e=new a.Matrix4,n=new a.Matrix4;return(i,u)=>{const o=[],r=[],s=new ft.L((t=>1/t.weight));for(let l=0;l<i.length;l++){const c=i[l];if(!c.initialized())continue;c.numVisiblePoints=0,c.visibleNodes=[],c.visibleGeometry=[],u.updateMatrixWorld(!1);const D=u.matrixWorldInverse,d=c.matrixWorld;if(t.identity().multiply(u.projectionMatrix).multiply(D).multiply(d),o.push((new a.Frustum).setFromProjectionMatrix(t)),e.copy(d).invert(),n.identity().multiply(e).multiply(u.matrixWorld),r.push((new a.Vector3).setFromMatrixPosition(n)),c.visible&&null!==c.root){const t=Number.MAX_VALUE;s.push(new At(l,t,c.root))}dt(c.root)&&c.hideDescendants(c.root.sceneNode);for(const t of c.boundingBoxNodes)t.visible=!1}return{frustums:o,cameraPositions:r,priorityQueue:s}}})()}loadSingle(t,e=((t,e)=>fetch(t,e))){return function(t,e){return function(t,e){return()=>{const n=new ct({url:t}),i=new $(n,new a.Box3,new a.Box3,new a.Vector3,e);i.url=t,i.needsUpdate=!0;const u={};return function(t,e){const n=new q("r",t,t.boundingBox,0);return n.hasChildren=!0,n.spacing=t.spacing||.1,n.numPoints=5e4,t.root=n,e.r=n,t.root.load()}(i,u).then((()=>(i.nodes=u,i)))}}(t,e)()}(t,e).then((t=>new nt(this,t)))}loadResonaiPointCloud(t,e,n=((t,e)=>fetch(t,e))){return console.log("loadResonaiPointCloud",t,e),function(t,e,n){return n(h(t),{mode:"cors"}).then((t=>t.json())).then(function(t,e,n){return console.log("@@@@@@@@@@@@@@@@@@@@@",t,e(t,0)),i=>{console.log("parseResonai",i);const u=function(t){const e=new a.Vector3(...t.min_bounding_box),n=e.clone().addScalar(t.scale);return new a.Box3(e,n)}(i),o=new ct({url:t,getUrl:e}),r=new $(o,u,u,new a.Vector3,n);r.url=t,r.needsUpdate=!0;const s={};return function(t,e,n,i){const u=new q("r",e,e.boundingBox,0);return u.hasChildren=!0,u.numPoints=16777215&n.nodes[0],u.numPoints=0,u.hierarchyUrl=t,e.root=u,i.r=u,e.root.loadResonai()}(t,r,i,s).then((()=>(r.nodes=s,r)))}}(h(t),e,n))}(t,e,n).then((t=>new nt(this,t)))}updatePointClouds(t,e,n){const i=this.updateVisibility(t,e,n);for(let i=0;i<t.length;i++){const u=t[i];u.disposed||(u.material.updateMaterial(u,u.visibleNodes,e,n),u.updateVisibleBounds(),u.updateBoundingBoxes())}return this.lru.freeMemory(),i}static pick(t,e,n,i,u={}){return gt.picker=gt.picker||new tt,gt.picker.pick(e,n,i,t,u)}get pointBudget(){return this._pointBudget}set pointBudget(t){t!==this._pointBudget&&(this._pointBudget=t,this.lru.pointBudget=t,this.lru.freeMemory())}updateVisibility(t,e,n){let i=0;const u=[],o=[],{frustums:r,cameraPositions:s,priorityQueue:a}=this.updateVisibilityStructures(t,e);let l,c=0,D=!1,d=!1;for(;void 0!==(l=a.pop());){let f=l.node;if(i+f.numPoints>this.pointBudget)break;const p=l.pointCloudIndex,h=t[p],C=void 0!==h.maxLevel?h.maxLevel:1/0;if(f.level>C||!r[p].intersectsBox(f.boundingBox)||this.shouldClip(h,f.boundingBox))continue;i+=f.numPoints,h.numVisiblePoints+=f.numPoints;const A=l.parent;if(Dt(f)&&(!A||dt(A)))if(f.loaded&&c<2)f=h.toTreeNode(f,A),c++;else{if(f.failed){d=!0;continue}f.loaded&&c>=2&&(D=!0),o.push(f),h.visibleGeometry.push(f)}dt(f)&&(this.updateTreeNodeVisibility(h,f,u),h.visibleGeometry.push(f.geometryNode));const g=.5*n.getSize(this._rendererSize).height*n.getPixelRatio();this.updateChildVisibility(l,a,h,f,s[p],e,g)}const f=Math.min(this.maxNumNodesLoading,o.length),p=[];for(let t=0;t<f;t++)p.push(o[t].load());return{visibleNodes:u,numVisiblePoints:i,exceededMaxLoadsToGPU:D,nodeLoadFailed:d,nodeLoadPromises:p}}updateTreeNodeVisibility(t,e,n){this.lru.touch(e.geometryNode);const i=e.sceneNode;i.visible=!0,i.material=t.material,i.updateMatrix(),i.matrixWorld.multiplyMatrices(t.matrixWorld,i.matrix),n.push(e),t.visibleNodes.push(e),this.updateBoundingBoxVisibility(t,e)}updateChildVisibility(t,e,n,i,u,o,r){const s=i.children;for(let a=0;a<s.length;a++){const l=s[a];if(null===l)continue;const D=l.boundingSphere,d=D.center.distanceTo(u),f=D.radius;let p=0;if(o.type===c){const t=o.fov*Math.PI/180;p=r/(Math.tan(t/2)*d)}else{const t=o;p=2*r/(t.top-t.bottom)}const h=f*p;if(h<n.minNodePixelSize)continue;const C=d<f?Number.MAX_VALUE:h+1/d;e.push(new At(t.pointCloudIndex,C,l,i))}}updateBoundingBoxVisibility(t,e){if(t.showBoundingBox&&!e.boundingBoxNode){const n=new pt(e.boundingBox);n.matrixAutoUpdate=!1,t.boundingBoxNodes.push(n),e.boundingBoxNode=n,e.boundingBoxNode.matrix.copy(t.matrixWorld)}else t.showBoundingBox&&e.boundingBoxNode?(e.boundingBoxNode.visible=!0,e.boundingBoxNode.matrix.copy(t.matrixWorld)):!t.showBoundingBox&&e.boundingBoxNode&&(e.boundingBoxNode.visible=!1)}shouldClip(e,n){const i=e.material;if(0===i.numClipBoxes||i.clipMode!==t.CLIP_OUTSIDE)return!1;const u=n.clone();e.updateMatrixWorld(!0),u.applyMatrix4(e.matrixWorld);const o=i.clipBoxes;for(let t=0;t<o.length;t++){const e=o[t].matrix,n=new a.Box3(new a.Vector3(-.5,-.5,-.5),new a.Vector3(.5,.5,.5)).applyMatrix4(e);if(u.intersectsBox(n))return!1}return!0}}class Ft{constructor(t){this.versionMinor=0,this.version=t;const e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e),10),this.versionMinor=parseInt(t.substr(e+1),10),isNaN(this.versionMinor)&&(this.versionMinor=0)}newerThan(t){const e=new Ft(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>e.versionMinor}equalOrHigher(t){const e=new Ft(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>=e.versionMinor}upTo(t){return!this.newerThan(t)}}})(),u})()}));